<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>è¤‡æ•°è»Šç¨®ã®ç‡ƒè²»æ¯”è¼ƒã‚¢ãƒ—ãƒª</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1 style="text-align: center;">è¤‡æ•°è»Šç¨®ã®ç‡ƒè²»æ¯”è¼ƒã‚¢ãƒ—ãƒª</h1>

  <div style="text-align: center;">
    <p>
      è»Šç¨®åï¼š<br>
      <input type="text" id="carName" placeholder="ä¾‹ï¼šãƒ—ãƒªã‚¦ã‚¹">
    </p>
    <p>
      èµ°è¡Œè·é›¢ï¼ˆkmï¼‰ï¼š<br>
      <input type="number" id="distance" placeholder="ä¾‹ï¼š500">
    </p>
    <p>
      æ¶ˆè²»ç‡ƒæ–™ï¼ˆLï¼‰ï¼š<br>
      <input type="number" id="fuel" placeholder="ä¾‹ï¼š25">
    </p>
    <button onclick="calculate()">ç‡ƒè²»ã‚’è¨ˆç®—</button>
    <p>
      <button onclick="removeCar()">ğŸš— ã“ã®è»Šç¨®ã‚’å‰Šé™¤</button>
      <button onclick="clearAll()">ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢</button>
    </p>

    <p id="result" style="font-size: 18px; margin-top: 20px;"></p>

    <h3>ã‚°ãƒ©ãƒ•</h3>
    <canvas id="efficiencyChart" width="400" height="200"></canvas>
  </div>

  <script>
    // è»Šç¨®ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿ç®¡ç†
    const carData = {};

    // Chart.js åˆæœŸåŒ–
    const ctx = document.getElementById('efficiencyChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: []
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    // ãƒ©ãƒ³ãƒ€ãƒ è‰²ç”Ÿæˆ
    function getRandomColor() {
      const r = Math.floor(Math.random() * 200);
      const g = Math.floor(Math.random() * 200);
      const b = Math.floor(Math.random() * 200);
      return `rgb(${r}, ${g}, ${b})`;
    }

    // ç‡ƒè²»ã‚’è¨ˆç®—ã—ã¦ã‚°ãƒ©ãƒ•ã«è¿½åŠ 
    function calculate() {
      const carName = document.getElementById('carName').value.trim();
      const distance = parseFloat(document.getElementById('distance').value);
      const fuel = parseFloat(document.getElementById('fuel').value);
      const resultArea = document.getElementById('result');

      if (!carName || isNaN(distance) || isNaN(fuel) || fuel <= 0) {
        resultArea.textContent = 'ã™ã¹ã¦æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆç‡ƒæ–™ã¯0ã‚ˆã‚Šå¤§ããï¼‰';
        return;
      }

      const efficiency = distance / fuel;
      resultArea.textContent = `${carName} ã®ç‡ƒè²»ã¯ ${efficiency.toFixed(2)} km/L`;

      // æ–°ã—ã„ãƒ©ãƒ™ãƒ«ï¼ˆè¨ˆç®—å›æ•°ï¼‰
      const label = `è¨ˆç®—${chart.data.labels.length + 1}`;
      if (!chart.data.labels.includes(label)) {
        chart.data.labels.push(label);
      }

      // æ–°è¦è»Šç¨®ãªã‚‰ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’ä½œæˆ
      if (!carData[carName]) {
        const color = getRandomColor();
        carData[carName] = {
          label: carName,
          data: [],
          borderColor: color,
          backgroundColor: color,
          tension: 0.2
        };
        chart.data.datasets.push(carData[carName]);
      }

      // ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®æ›´æ–°ï¼ˆnullåŸ‹ã‚ã‚ã‚Šï¼‰
      chart.data.datasets.forEach(ds => {
        if (ds.label === carName) {
          ds.data.push(efficiency.toFixed(2));
        } else {
          if (ds.data.length < chart.data.labels.length) {
            ds.data.push(null);
          }
        }
      });

      chart.update();
    }

    // æŒ‡å®šã—ãŸè»Šç¨®ã®ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
    function removeCar() {
      const carName = document.getElementById('carName').value.trim();
      if (!carName || !carData[carName]) {
        alert('å‰Šé™¤ã™ã‚‹è»Šç¨®åã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      // ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‹ã‚‰å‰Šé™¤
      chart.data.datasets = chart.data.datasets.filter(ds => ds.label !== carName);
      delete carData[carName];
      chart.update();
    }

    // å…¨å±¥æ­´ã‚¯ãƒªã‚¢
    function clearAll() {
      if (!confirm('ã™ã¹ã¦ã®å±¥æ­´ã¨ã‚°ãƒ©ãƒ•ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;

      chart.data.labels = [];
      chart.data.datasets = [];
      for (let key in carData) delete carData[key];

      chart.update();
      document.getElementById('result').textContent = '';
    }
  </script>
</body>
</html>
